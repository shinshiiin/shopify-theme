{% liquid
  # Count ingredients per column
  assign left_column_count = 0
  assign right_column_count = 0
  for block in section.blocks
    if block.settings.column_position == 'left'
      assign left_column_count = left_column_count | plus: 1
    elsif block.settings.column_position == 'right'
      assign right_column_count = right_column_count | plus: 1
    endif
  endfor
%}

<div class="section">
  <div class="container">
    <div class="product-ingredients-section {{ section.id }}">
      {%- comment -%} Editor Warning {%- endcomment -%}
      {%- if request.design_mode -%}
        {%- if left_column_count > 5 or right_column_count > 5 -%}
          <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 16px; margin-bottom: 24px; text-align: left;">
            <strong style="color: #856404;">⚠️ Ingredient Limit Exceeded</strong>
            <p style="color: #856404; margin: 8px 0 0 0; font-size: 14px;">
              {%- if left_column_count > 5 -%}
                Left column: {{ left_column_count }} ingredients (max 5). Only the left 5 will display.<br>
              {%- endif -%}
              {%- if right_column_count > 5 -%}
                Right column: {{ right_column_count }} ingredients (max 5). Only the left 5 will display.
              {%- endif -%}
            </p>
          </div>
        {%- endif -%}
      {%- endif -%}
      
      <div class="title-section">
        {%- if section.settings.section_title != blank -%}
            <h1 class="section-title">
            {{ section.settings.section_title }}
            </h1>
        {%- endif -%}
        {%- if section.settings.section_subtitle != blank -%}
            <h2 class="section-subtitle">
            {{ section.settings.section_subtitle }}
            </h2>
        {%- endif -%}
      </div>
      
      <div class="grid-container">
        
        {%- comment -%} Left Column {%- endcomment -%}
        <div class="columns left">
          {%- assign left_item_count = 0 -%}
          {%- for block in section.blocks -%}
            {%- if block.settings.column_position == 'left' -%}
              {%- assign left_item_count = left_item_count | plus: 1 -%}
              {%- if left_item_count <= 5 -%}
                <div class="ingredient" {{ block.shopify_attributes }}>
                  <div class="ingredient-icon-image">
                    {%- if block.settings.ingredient_icon != blank -%}
                      <img 
                        src="{{ block.settings.ingredient_icon | image_url: width: 72 }}" 
                        alt="{{ block.settings.ingredient_title }}" 
                        class="ingredient-icon"
                        loading="lazy"
                        width="36"
                        height="36"
                      >
                      {% else %}
                      <img
                        src="{{ 'placeholder_2.webp' | asset_url }}"
                        alt="{{ block.settings.customer_name | default: 'Customer' }}"
                        loading="lazy"
                      >
                    {%- endif -%}
                  </div>
                  <h3>{{ block.settings.ingredient_title }}</h3>
                  <p>{{ block.settings.ingredient_text }}</p>
                </div>
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
        </div>

        {%- comment -%} CENTER IMAGE {%- endcomment -%}
        <div class="center-image">
          {% if section.settings.center_image %}
              <img
                src="{{ section.settings.center_image | image_url: width: 1000 }}"
                alt="{{ block.settings.customer_name | default: 'Customer' }}"
                loading="lazy"
              >
            {% else %}
              <img
                src="{{ 'placeholder_1.webp' | asset_url }}"
                alt="{{ block.settings.customer_name | default: 'Customer' }}"
                loading="lazy"
              >
            {% endif %}
        </div>

        {%- comment -%} RIGHT COLUMN {%- endcomment -%}
        <div class="columns right">
          {%- assign right_item_count = 0 -%}
          {%- for block in section.blocks -%}
            {%- if block.settings.column_position == 'right' -%}
              {%- assign right_item_count = right_item_count | plus: 1 -%}
              {%- if right_item_count <= 5 -%}
                <div class="ingredient" {{ block.shopify_attributes }}>
                  <div class="ingredient-icon-image">
                    {%- if block.settings.ingredient_icon != blank -%}
                      <img 
                        src="{{ block.settings.ingredient_icon | image_url: width: 72 }}" 
                        alt="{{ block.settings.ingredient_title }}" 
                        class="ingredient-icon"
                        loading="lazy"
                        width="36"
                        height="36"
                      >
                      {% else %}
                      <img
                        src="{{ 'placeholder_2.webp' | asset_url }}"
                        alt="{{ block.settings.customer_name | default: 'Customer' }}"
                        loading="lazy"
                      >  
                    {%- endif -%}
                  </div>
                  <h3>{{ block.settings.ingredient_title }}</h3>
                  <p>{{ block.settings.ingredient_text }}</p>
                </div>
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>

      {%- comment -%} All Ingredients Dropdown {%- endcomment -%}
      {%- if section.settings.all_ingredients != blank -%}
        <div class="all-ingredients">
          <div class="drop-header">
            <span>All Ingredients</span>
            <span class="chevron">
              <img 
                src="{{ 'arrow-down.webp' | asset_url }}" 
                alt="Toggle ingredients"
                class="chevron-icon"
                width="14"
                height="14"
              >
            </span>
          </div>
          <div class="drop-content">
            {{ section.settings.all_ingredients }}
          </div>
        </div>
      {%- endif -%}
  </div>
</div>

{% style %}
/* ========================================
   CONTAINER & LAYOUT
   ======================================== */
.product-ingredients-section {
  background: {{ section.settings.section_background }}
}
.product-ingredients-section .container{
  max-width: 1280px;
}
.title-section {
    justify-items: center;
    margin-bottom: 40px;
}

.product-ingredients-section .section-title {
    margin: 0 0 15px 0;
    font-family: 'Albert Sans', sans-serif; 
    font-weight: medium;
    text-transform: none;
    letter-spacing: 1px;
    margin: 0 0 15px 0;
    color: {{ section.settings.title_color }} !important; 
    font-size: {{ section.settings.title_size }}px !important;
}

.product-ingredients-section .section-subtitle {
    margin: 0;
    color: {{ section.settings.subtitle_color }}; 
    font-size: {{ section.settings.subtitle_size }}px;
}

.product-ingredients-section .grid-container {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  align-items: center;
  width: 100%;
  margin-bottom: 50px;
}

/* ========================================
   INGREDIENT COLUMNS
   ======================================== */
.product-ingredients-section .columns {
  display: flex;
  flex-direction: column;
  gap: 40px;
  height: 100%;
  justify-content: space-between;
}

.product-ingredients-section .ingredient {
  position: relative;
  display: flex;
  flex-direction: column;
  text-align: left;
}

.product-ingredients-section .columns .ingredient .ingredient-icon-image img{
  width: 36px;
  margin-bottom: 12px;
}

.product-ingredients-section .ingredient-icon {
  display: block;
  width: 100%;
  height: auto;
}

/* Left Column Alignment */
.product-ingredients-section .columns.left .ingredient {
  align-items: end;
  text-align: end;
}

/* Dynamic Middle Item Padding - Left Column */
/* 3 items: middle item (2nd) gets padding */
.product-ingredients-section .columns.left .ingredient:nth-child(2):nth-last-child(2) {
  padding-right: 40px;
}

/* 4 items: 2nd and 3rd items get padding */
.product-ingredients-section .columns.left .ingredient:nth-child(2):nth-last-child(3),
.product-ingredients-section .columns.left .ingredient:nth-child(3):nth-last-child(2) {
  padding-right: 40px;
}

/* 5 items: 2nd, 3rd, and 4th items get padding */
.product-ingredients-section .columns.left .ingredient:nth-child(2):nth-last-child(4),
.product-ingredients-section .columns.left .ingredient:nth-child(3):nth-last-child(3),
.product-ingredients-section .columns.left .ingredient:nth-child(4):nth-last-child(2) {
  padding-right: 40px;
}

/* Right Column Alignment */
/* Dynamic Middle Item Padding - Right Column */
/* 3 items: middle item (2nd) gets padding */
.product-ingredients-section .columns.right .ingredient:nth-child(2):nth-last-child(2) {
  padding-left: 40px;
}

/* 4 items: 2nd and 3rd items get padding */
.product-ingredients-section .columns.right .ingredient:nth-child(2):nth-last-child(3),
.product-ingredients-section .columns.right .ingredient:nth-child(3):nth-last-child(2) {
  padding-left: 40px;
}

/* 5 items: 2nd, 3rd, and 4th items get padding */
.product-ingredients-section .columns.right .ingredient:nth-child(2):nth-last-child(4),
.product-ingredients-section .columns.right .ingredient:nth-child(3):nth-last-child(3),
.product-ingredients-section .columns.right .ingredient:nth-child(4):nth-last-child(2) {
  padding-left: 40px;
}

/* Typography */
.product-ingredients-section .ingredient h3 {
  color: {{ section.settings.ingredient_name_color }};
  font-size: {{ section.settings.ingredient_name_size }}px;
  margin-bottom: 8px;
  margin-top: 0;
}

.product-ingredients-section .ingredient p {
  font-size: {{ section.settings.description_size }}px;
  line-height: 1.5;
  color:{{ section.settings.description_color }};
  margin: 0;
}

/* ========================================
   CENTER IMAGE
   ======================================== */
.product-ingredients-section .center-image {
  position: relative;
  text-align: center;
}

.center-image img {
    width: {{ section.settings.image_size }}px !important;
}

.product-ingredients-section .mask-img {
  position: relative;
  width: 100%;
  max-width: 400px;
  height: auto;
  z-index: 2;
}

/* ========================================
   INGREDIENTS DROPDOWN
   ======================================== */
.product-ingredients-section .all-ingredients {
  width: 100%;
  padding: 0;
  background: #FDFDFD;
  border-radius: 14px;
  overflow: hidden;
  text-align: left;
}

.product-ingredients-section .drop-header {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  padding: 18px 24px;
  font-size: 24px;
  color: #4d4563;
  cursor: pointer;
  user-select: none;
}

.product-ingredients-section .chevron {
  display: inline-flex;
  align-items: center;
}

.product-ingredients-section .chevron-icon {
  width: 14px;
  height: auto;
  transition: transform 0.3s ease;
}

.product-ingredients-section .all-ingredients.open .chevron-icon {
  transform: rotate(180deg);
}

.product-ingredients-section .drop-content {
  display: none;
  padding: 0 24px 20px;
  font-size: 14px;
  line-height: 1.6;
  color: #6b657c;
  text-align: center;
}

.product-ingredients-section .all-ingredients.open .drop-content {
  display: block;
  font-family: 'Chivo Mono', monospace;
}

/* ========================================
   MOBILE RESPONSIVENESS
   ======================================== */
@media (max-width: 768px) {
  .product-ingredients-section .container {
    padding: 40px 20px;
  }

  .product-ingredients-section .title-section {
    font-size: 26px;
    margin-bottom: 40px;
    text-align: center;
  }

  .product-ingredients-section .grid-container {
    grid-template-columns: 1fr;
    gap: 16px;
    margin-bottom: 0;
  }

  /* Reorder Grid Items */
  .product-ingredients-section .center-image {
    order: 1;
  }

  .product-ingredients-section .columns.left {
    order: 2;
  }

  .product-ingredients-section .columns.right {
    order: 3;
  }

  /* Reset Column Styling */
  .product-ingredients-section .columns.left,
  .product-ingredients-section .columns.right {
    align-items: flex-start;
    text-align: left;
    gap: 16px;
  }

  /* Mobile Ingredient Cards */
  .product-ingredients-section .ingredient {
    flex-direction: column;
    gap: 8px;
    align-items: center !important;
    justify-content: center !important;
    padding: 12px 32px;
    background-color: #FDFDFD;
    border-radius: 12px;
    text-align: center;
  }

  /* Reset all dynamic padding on mobile */
  .product-ingredients-section .columns.left .ingredient,
  .product-ingredients-section .columns.right .ingredient {
    padding: 12px 32px !important;
    width: 100%;
  }



  .product-ingredients-section .ingredient h3 {
    margin: 0;
    text-align: center;
  }

  .product-ingredients-section .ingredient p {
    margin-top: 2px;
    text-align: center;
  }

  /* Center Image Resize */
  .product-ingredients-section .center-image img{
    width: 389px !important;
    height: auto;
  }

  .product-ingredients-section .mask-img {
    max-width: 210px;
  }

  /* Dropdown Spacing */
  .product-ingredients-section .all-ingredients {
    margin-top: 40px;
  }
}

/* Extra Small Screens */
@media (max-width: 480px) {
  .product-ingredients-section .vwcm-title {
    font-size: 22px;
  }

  .product-ingredients-section .center-image img {
    width: 290px !important;
    height: auto;
  }
}
{% endstyle %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ingredientsBlock = document.querySelector('.product-ingredients-section .all-ingredients');
    
    if (ingredientsBlock) {
      const header = ingredientsBlock.querySelector('.drop-header');
      
      header.addEventListener('click', function() {
        ingredientsBlock.classList.toggle('open');
      });
    }
  });
</script>

{% schema %}
{
  "name": "Product Ingredients",
  "max_blocks": 10,
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Product Ingredients"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#605471"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 20,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Title Size",
      "default": 40
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "Formulated with thoughtfully chosen ingredients for optimal results."
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color",
      "default": "#656565"
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 14,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Subtitle Size",
      "default": 20
    },
    {
      "type": "color",
      "id": "section_background",
      "label": "Section Background Color",
      "default": "#f7f9fd"
    },
    {
      "type": "header",
      "content": "Ingredients Styling"
    },
    {
      "type": "range",
      "id": "ingredient_name_size",
      "min": 14,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Ingredient Name Size",
      "default": 24
    },
    {
      "type": "color",
      "id": "ingredient_name_color",
      "label": "Ingredient Name Color",
      "default": "#282828"
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 14,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Description Size",
      "default": 14
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Descripton Color",
      "default": "#746c8a"
    },
    {
      "type": "header",
      "content": "Center Image"
    },
    {
      "type": "image_picker",
      "id": "center_image",
      "label": "Center Image"
    },
    {
      "type": "range",
      "id": "image_size",
      "min": 200,
      "max": 360,
      "step": 5,
      "unit": "px",
      "label": "Image Size",
      "default": 360
    },
    {
      "type": "header",
      "content": "All Ingredients Dropdown"
    },
    {
      "type": "richtext",
      "id": "all_ingredients",
      "label": "All Ingredients List",
      "info": "Full ingredient list shown in dropdown"
    }
  ],
  "blocks": [
    {
      "type": "ingredient",
      "name": "Ingredient",
      "limit": 10,
      "settings": [
                {
                  "type": "select",
                  "id": "column_position",
                  "label": "Column Position",
                  "options": [
                    {
                      "value": "left",
                      "label": "Left"
                    },
                    {
                      "value": "right",
                      "label": "Right"
                    }
                  ],
                  "default": "left",
                  "info": "Maximum 5 ingredients per column recommended"
                },
                {
                  "type": "image_picker",
                  "id": "ingredient_icon",
                  "label": "Ingredient Icon"
                },
                {
                  "type": "text",
                  "id": "ingredient_title",
                  "label": "Ingredient Title",
                  "default": "Ingredient Name"
                },
                {
                  "type": "textarea",
                  "id": "ingredient_text",
                  "label": "Ingredient Description",
                  "default": "Brief description of this ingredient and its benefits."
                }
              ]
            }
          ],
          "presets": [
            {
              "name": "Product Ingredients",
              "blocks": [
        {
          "type": "ingredient",
          "settings": {
            "column_position": "left",
            "ingredient_title": "Vitamin C",
            "ingredient_text": "Brightens skin and helps even out tone"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "left",
            "ingredient_title": "Hyaluronic Acid",
            "ingredient_text": "Provides deep hydration and plumps the skin"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "left",
            "ingredient_title": "Niacinamide",
            "ingredient_text": "Helps minimize pores and improve skin texture"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "left",
            "ingredient_title": "Alpha Arbutin",
            "ingredient_text": "Targets dark spots and promotes a more even complexion"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "left",
            "ingredient_title": "Panthenol (Vitamin B5)",
            "ingredient_text": "Soothes skin and supports the moisture barrier"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "right",
            "ingredient_title": "Retinol",
            "ingredient_text": "Reduces the appearance of fine lines and wrinkles"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "right",
            "ingredient_title": "Peptides",
            "ingredient_text": "Supports collagen production for firmer-looking skin"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "right",
            "ingredient_title": "Ceramides",
            "ingredient_text": "Strengthens the skin barrier and locks in moisture"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "right",
            "ingredient_title": "Green Tea Extract",
            "ingredient_text": "Provides antioxidant protection against environmental stress"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "column_position": "right",
            "ingredient_title": "Licorice Root Extract",
            "ingredient_text": "Calms irritation and helps brighten uneven skin tone"
          }
        }
      ]
    }
  ]
}
{% endschema %}
