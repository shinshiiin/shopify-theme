

<div class="custom-delivery-date-wrap">
  <div class="custom-delivery-date">
    <p>Save up to <span class="discount-off-timer"></span> off ends in</p>
  </div>
  <div id="countdown">
    <ul>
      <li>
        <span class="hours countdown-no"></span>
        <span class="countdown-label">HRS</span>
      </li>
      <li class="countdown-divider">
        <span>:</span>
      </li>
      <li>
        <span class="minutes countdown-no"></span>
        <span class="countdown-label">MIN</span>
      </li>
      <li class="countdown-divider">
        <span>:</span>
      </li>
      <li>
        <span class="seconds countdown-no"></span>
        <span class="countdown-label">SEC</span>
      </li>
    </ul>
  </div>
</div>

  <script>
     window.addEventListener('load', function() {
      const swatches = document.querySelectorAll('.swatch-element');
      if (swatches.length === 0) {
        
        const discountElements = document.querySelectorAll('.discount-off-timer');
        discountElements.forEach(function(element) {
          element.innerText = '{% if product.compare_at_price > product.price %}{% assign discount = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}{{ discount | round }}% OFF{% endif %}';
        });

        console.log('No swatches found, skipping discount calculation.');

        return; 
      }
      let highestDiscount = 0; 
  
      swatches.forEach(function(swatch) {
        const price = parseFloat(swatch.getAttribute('data-price').slice(1).replace(/,/g, ''));
        const compare_price = parseFloat(swatch.getAttribute('data-compare').slice(1).replace(/,/g, ''));
  
        const discountPercent = Math.round(((compare_price - price) / compare_price) * 100);
  
        if (discountPercent > highestDiscount) {
          highestDiscount = discountPercent;
        }
      });
       
      const discountElements = document.querySelectorAll('.discount-off-timer');
      discountElements.forEach(function(element) {
        element.innerText = `${highestDiscount}%`;
      });
    });
  </script>

{% style %}

  .product-block--{{ block.type }} {
    margin-top: 10px;
  }
  
  .product-block--{{ block.type }} .custom-delivery-date-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #EBF1FD;
    border-color: #EBF1FD;
    padding: 2px 10px;
    border-radius: 5px;
  }

  .product-block--{{ block.type }} .custom-delivery-date p {
    font-weight: 700;
    font-size: 14px;
    text-transform: uppercase;
    line-height: 1.2em;
    margin-bottom: 0px;
    color: #605471;
  }

  .product-block--{{ block.type }} #countdown {
    margin-left:10px;
  }

  .product-block--{{ block.type }} #countdown ul li {
    border: 1px solid #ededed;
    border-radius: 3px;
    color: #605471;
  }

  .product-block--{{ block.type }} #countdown .countdown-no, .product-block--{{ block.type }} #countdown .countdown-label {
    line-height: 1em;
  }

  .product-block--{{ block.type }} #countdown ul li.countdown-divider {
    border: none;
  }

  @media only screen and (max-width: 768px) {
    .product-block--{{ block.type }} #countdown {
      margin-left:10px;
    }

    

    .product-block--{{ block.type }} .custom-delivery-date p {
      text-align: center;
      font-size: 13px;
    }
  }
  
{% endstyle %}